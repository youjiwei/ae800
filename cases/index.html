<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>案例 - 东方和平展览展示中心（AE800）</title>
  <meta name="description" content="客户案例列表（新站模板）。" />
  <link rel="canonical" href="https://www.ae800.com/cases/" />
  <meta property="og:title" content="案例库 - AE800" />
  <meta property="og:description" content="博物馆、城市展厅、临展与商业展示案例。按项目背景、交付范围与呈现效果整理。" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.ae800.com/cases/" />
  <meta property="og:image" content="https://images.unsplash.com/photo-1521737604893-d14cc237f11d?auto=format&fit=crop&w=2000&q=70" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="案例库 - AE800" />
  <meta name="twitter:description" content="博物馆、城市展厅、临展与商业展示案例。按项目背景、交付范围与呈现效果整理。" />
  <meta name="twitter:image" content="https://images.unsplash.com/photo-1521737604893-d14cc237f11d?auto=format&fit=crop&w=2000&q=70" />
  <link rel="icon" href="data:," />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Noto+Sans+SC:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="stylesheet" href="../assets/styles.css" />

  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": "案例库 - AE800",
      "url": "https://www.ae800.com/cases/",
      "inLanguage": ["zh-CN", "en"],
      "breadcrumb": {
        "@type": "BreadcrumbList",
        "itemListElement": [
          {"@type": "ListItem", "position": 1, "name": "首页", "item": "https://www.ae800.com/"},
          {"@type": "ListItem", "position": 2, "name": "案例", "item": "https://www.ae800.com/cases/"}
        ]
      }
    }
  </script>
</head>
<body class="font-sans text-slate-900 bg-slate-50">
  <style>
    .case-tag-groups{display:flex;flex-direction:column;gap:.75rem;}
    .case-tag-group{display:block;}
    .case-tag-row{display:flex;align-items:flex-start;gap:.5rem;}
    .case-tag-prefix{flex:0 0 auto;}
    .case-tag-strip{flex:1 1 auto;min-width:0;display:flex;flex-wrap:nowrap;gap:.5rem;overflow-x:auto;overflow-y:hidden;padding-bottom:2px;-webkit-overflow-scrolling:touch;scrollbar-width:none;}
    .case-tag-strip::-webkit-scrollbar{display:none;}
    .case-tag-chip{white-space:nowrap;}
    .case-tag-chip span{word-break:break-word;overflow-wrap:anywhere;}
  </style>
  <header class="fixed top-0 inset-x-0 z-50" id="siteHeader">
    <div class="bg-white/80 backdrop-blur border-b border-slate-200" id="headerBar">
      <div class="mx-auto max-w-6xl px-4 sm:px-6">
        <div class="flex items-center justify-between h-16">
          <a class="flex items-center gap-3" href="../index.html" aria-label="返回首页">
            <div class="h-9 w-9 rounded-lg bg-brand-600 text-white grid place-items-center font-bold">AE</div>
            <div class="leading-tight">
              <div class="font-semibold">AE800</div>
              <div class="text-xs text-slate-500" data-i18n="brand_tagline">数字化展陈 · 灯箱系统 · 互动装置</div>
            </div>
          </a>

          <nav class="hidden md:flex items-center gap-6" aria-label="主导航">
            <a class="nav-link" href="../capabilities/index.html" data-i18n="nav_capabilities">能力</a>
            <a class="nav-link" href="../solutions/index.html" data-i18n="nav_solutions">解决方案</a>
            <a class="nav-link" href="../services/index.html" data-i18n="nav_services">服务</a>
            <a class="nav-link" href="../products/index.html" data-i18n="nav_products">产品</a>
            <a class="nav-link" href="./index.html" data-i18n="nav_cases">案例</a>
            <a class="nav-link" href="../docs/index.html" data-i18n="nav_docs">资料</a>
            <a class="nav-link" href="../contact/index.html" data-i18n="nav_contact">联系</a>
            <a class="btn btn-filled" href="../contact/index.html" data-cta="top">
              <i class="fa-solid fa-comment-dots"></i>
              <span data-i18n="nav_cta">获取方案</span>
            </a>
          </nav>

          <button class="md:hidden inline-flex items-center justify-center h-10 w-10 rounded-lg border border-slate-200 bg-white" id="mobileMenuBtn" aria-label="打开菜单" aria-expanded="false" aria-controls="mobileMenu">
            <i class="fa-solid fa-bars"></i>
          </button>
        </div>
      </div>

      <div class="md:hidden hidden" id="mobileMenu">
        <div class="mx-auto max-w-6xl px-4 sm:px-6 pb-4">
          <div class="rounded-2xl border border-slate-200 bg-white p-3 shadow-sm">
            <a class="mobile-link" href="../capabilities/index.html" data-i18n="nav_capabilities">能力</a>
            <a class="mobile-link" href="../solutions/index.html" data-i18n="nav_solutions">解决方案</a>
            <a class="mobile-link" href="../services/index.html" data-i18n="nav_services">服务</a>
            <a class="mobile-link" href="../products/index.html" data-i18n="nav_products">产品</a>
            <a class="mobile-link" href="./index.html" data-i18n="nav_cases">案例</a>
            <a class="mobile-link" href="../docs/index.html" data-i18n="nav_docs">资料</a>
            <a class="mobile-link" href="../contact/index.html" data-i18n="nav_contact">联系</a>
            <div class="pt-2">
              <a class="btn btn-filled w-full" href="../contact/index.html" data-cta="mobile">
                <i class="fa-solid fa-phone"></i>
                <span data-i18n="nav_cta_mobile">立即咨询</span>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="mx-auto max-w-6xl px-4 sm:px-6 py-10 pt-16">
    <div class="flex items-end justify-between gap-6 flex-wrap">
      <div>
        <h1 class="text-3xl font-bold">案例库</h1>
        <p class="mt-3 text-slate-600 max-w-3xl">本页为“本地 JSON + 静态详情页”的案例模板：分类筛选 + 关键词搜索 + 站内详情页（利于 SEO）。后续你运行抓取脚本即可自动更新数据与图片。</p>
      </div>
      <a class="btn btn-filled" href="../contact/index.html">
        <i class="fa-solid fa-comment-dots"></i>
        <span>咨询同类项目</span>
      </a>
    </div>

    <div class="mt-6 hidden" id="caseLoadAlert" style="border-radius:var(--radius)">
      <div class="rounded-3xl border border-amber-200 bg-amber-50 p-5" style="border-radius:var(--radius)">
        <div class="font-semibold text-amber-900">案例数据未加载</div>
        <div class="mt-2 text-sm text-amber-900/80" id="caseLoadAlertText"></div>
      </div>
    </div>

    <section class="mt-8 rounded-3xl bg-white border border-slate-200 p-4 sm:p-5" style="border-radius:var(--radius)" id="tags">
      <div class="flex flex-col lg:flex-row gap-4 lg:items-center lg:justify-between">
        <div>
          <div class="text-sm font-semibold text-slate-900">标签筛选</div>
        </div>
        <a class="btn btn-outlined" href="#filters">更多筛选</a>
      </div>
      <div class="mt-4 case-tag-groups" id="caseTagFilters" aria-label="案例标签筛选"></div>
    </section>

    <section class="mt-8 rounded-3xl bg-white border border-slate-200 p-4 sm:p-5" style="border-radius:var(--radius)" id="filters">
      <div class="flex flex-col lg:flex-row gap-4 lg:items-center lg:justify-between">
        <div class="flex flex-wrap gap-2" id="caseCategoryFilters" aria-label="筛选操作"></div>
        <div class="w-full lg:w-80">
          <div class="relative">
            <i class="fa-solid fa-magnifying-glass text-slate-400 absolute left-3 top-1/2 -translate-y-1/2"></i>
            <input id="caseKeyword" type="search" placeholder="搜索：项目名称 / 地区 / 关键词" class="w-full rounded-2xl border border-slate-200 bg-slate-50 pl-9 pr-3 py-2 text-sm outline-none focus:border-blue-400" style="border-radius:var(--radius)" />
          </div>
          <div class="mt-2 text-xs text-slate-500" id="caseResultMeta"></div>
        </div>
      </div>
    </section>

    <div class="mt-6 grid md:grid-cols-2 lg:grid-cols-3 gap-6" id="caseList"></div>
  </main>

  <footer class="py-12">
    <div class="mx-auto max-w-6xl px-4 sm:px-6">
      <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-8">
        <div>
          <div class="font-semibold">AE800</div>
          <div class="mt-3 text-sm text-slate-600" data-i18n="footer_brand_desc">数字化体验 · 展示结构 · 互动装置的整合落地供应商。把灯箱、结构与互动模块化，让空间开口说话。</div>
        </div>
        <div>
          <div class="font-semibold" data-i18n="footer_quick">快速入口</div>
          <div class="mt-3 space-y-2 text-sm">
            <a class="footer-link" href="../capabilities/index.html">能力</a>
            <a class="footer-link" href="../solutions/index.html">解决方案</a>
            <a class="footer-link" href="../services/index.html">服务</a>
            <a class="footer-link" href="../products/index.html">产品</a>
            <a class="footer-link" href="./index.html">案例</a>
            <a class="footer-link" href="../docs/index.html" data-i18n="footer_docs">投标与资料</a>
            <a class="footer-link" href="../contact/index.html">联系</a>
          </div>
        </div>
        <div>
          <div class="font-semibold" data-i18n="footer_services">服务项目</div>
          <div class="mt-3 space-y-2 text-sm">
            <div class="text-slate-600" data-i18n="footer_s1">展示设计 / 装修装饰</div>
            <div class="text-slate-600" data-i18n="footer_s2">数字多媒体 / 活动执行</div>
            <div class="text-slate-600" data-i18n="footer_s3">市场推广 / 企业形象展示</div>
          </div>
        </div>
        <div>
          <div class="font-semibold" data-i18n="footer_contact">联系</div>
          <div class="mt-3 space-y-2 text-sm text-slate-600">
            <div>电话：010-66169644</div>
            <div>邮箱：139965886@qq.com</div>
            <div>公众号：ae800com</div>
          </div>
        </div>
      </div>

      <div class="mt-10 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 border-t border-slate-200 pt-6">
        <div class="text-sm text-slate-500">Copyright © 2001 - 2025 ae800.com</div>
        <div class="text-sm text-slate-500" data-i18n="footer_note">新站模板 · 可交互静态演示</div>
      </div>
    </div>
  </footer>

  <div class="modal hidden" id="caseModal" role="dialog" aria-modal="true" aria-label="案例模板字段" tabindex="-1">
    <div class="modal-backdrop" data-modal-close></div>
    <div class="modal-panel">
      <div class="modal-header">
        <div>
          <div class="text-xs text-slate-500">案例模板字段</div>
          <div class="font-semibold" id="caseModalTitle">案例详情</div>
        </div>
        <button class="modal-close" type="button" data-modal-close aria-label="关闭">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
      <div class="modal-body" style="padding:1rem;">
        <div class="grid sm:grid-cols-2 gap-4" id="caseModalBody"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outlined" type="button" data-modal-close>关闭</button>
      </div>
    </div>
  </div>

  <script src="../assets/main.js"></script>
  <script>
    (() => {
      const $ = (s, r = document) => r.querySelector(s);

      const listEl = $('#caseList');
      const filtersEl = $('#caseCategoryFilters');
      const tagFiltersEl = $('#caseTagFilters');
      const alertEl = $('#caseLoadAlert');
      const alertTextEl = $('#caseLoadAlertText');
      const keywordEl = $('#caseKeyword');
      const metaEl = $('#caseResultMeta');
      const modal = $('#caseModal');
      const modalTitle = $('#caseModalTitle');
      const modalBody = $('#caseModalBody');
      if (!listEl || !filtersEl || !tagFiltersEl || !keywordEl || !metaEl || !alertEl || !alertTextEl) return;

      const showAlert = (msg) => {
        alertTextEl.textContent = msg;
        alertEl.classList.remove('hidden');
      };

      const hideAlert = () => {
        alertEl.classList.add('hidden');
      };

      const categories = [
        { key: 'all', label: '全部' },
        { key: 'museum', label: '博物馆/纪念馆' },
        { key: 'achievement', label: '大型成就展' },
        { key: 'city', label: '城市展厅/展馆' },
        { key: 'brand', label: '标识/形象展示' },
        { key: 'retail', label: '商业展示' }
      ];

      let cases = [];
      const active = { time: 'all', place: 'all', theme: 'all', tech: 'all' };

      const readParams = () => {
        const p = new URLSearchParams(location.search);
        const time = (p.get('time') || '').trim();
        const place = (p.get('place') || '').trim();
        const theme = (p.get('theme') || '').trim();
        const tech = (p.get('tech') || '').trim();
        const q = (p.get('q') || '').trim();
        return { time, place, theme, tech, q };
      };

      const syncUrl = () => {
        const p = new URLSearchParams();
        if (active.time && active.time !== 'all') p.set('time', active.time);
        if (active.place && active.place !== 'all') p.set('place', active.place);
        if (active.theme && active.theme !== 'all') p.set('theme', active.theme);
        if (active.tech && active.tech !== 'all') p.set('tech', active.tech);
        const q = String(keywordEl.value || '').trim();
        if (q) p.set('q', q);
        const next = `${location.pathname}${p.toString() ? `?${p.toString()}` : ''}`;
        history.replaceState(null, '', next);
      };

      const categoryColor = (key) => {
        const map = {
          museum: 'bg-blue-600',
          achievement: 'bg-slate-800',
          city: 'bg-emerald-600',
          brand: 'bg-amber-500',
          retail: 'bg-fuchsia-600',
          all: 'bg-blue-600'
        };
        return map[key] || map.all;
      };

      const hashText = (s) => {
        const str = String(s || '');
        let h = 2166136261;
        for (let i = 0; i < str.length; i += 1) {
          h ^= str.charCodeAt(i);
          h = Math.imul(h, 16777619);
        }
        return h >>> 0;
      };

      const tagColor = (tag) => {
        const palette = ['#2563eb', '#7c3aed', '#db2777', '#ea580c', '#16a34a', '#0ea5e9', '#64748b', '#f59e0b', '#ef4444', '#10b981'];
        const h = hashText(tag);
        return palette[h % palette.length];
      };

      const renderTagPill = (t) => {
        const color = tagColor(t);
        const safe = String(t || '');
        return `<span class="pill" style="display:inline-flex;align-items:center;gap:.4rem;"><span aria-hidden="true" style="width:.45rem;height:.45rem;border-radius:999px;background:${color};"></span><span>${safe}</span></span>`;
      };

      const trunc = (s, n = 30) => {
        const t = String(s || '').replace(/\s+/g, ' ').trim();
        if (!t) return '';
        if (t.length <= n) return t;
        return t.slice(0, n) + '…';
      };

      const normalizeCityForUi = (input) => {
        const s = String(input || '').trim();
        if (!s) return '';
        if (/^线上/.test(s) || /线上活动/.test(s)) return '线上';
        if (/国家博物馆/.test(s)) return '北京';
        if (/^北京/.test(s)) return '北京';
        if (/^江苏/.test(s)) return '江苏省';
        if (/^陕西/.test(s) || /延安|西安/.test(s)) return '陕西省';
        if (/^云南/.test(s) || /腾冲|昆明/.test(s)) return '云南省';
        return s.split(/\s|,|，/)[0];
      };

      const renderCover = (c) => {
        const img = Array.isArray(c.images) && c.images.length ? c.images[0] : '';
        if (img) {
          const safe = img.replace(/'/g, '%27');
          const alt = (c.title || '').replace(/"/g, '&quot;');
          return `
            <a href="${img}" data-lightbox data-lb-src="${img}" data-lb-alt="${alt}" data-lb-group="cases-list" class="block" aria-label="查看大图">
              <div class="case-cover" style="background-image:url('${safe}')"></div>
            </a>
          `;
        }
        const map = {
          museum: 'from-blue-700 to-indigo-600',
          achievement: 'from-slate-900 to-slate-700',
          city: 'from-emerald-700 to-teal-600',
          brand: 'from-amber-600 to-orange-600',
          retail: 'from-fuchsia-700 to-pink-600',
          all: 'from-blue-700 to-indigo-600'
        };
        const grad = map[c.category] || map.all;
        const cityShown = normalizeCityForUi(c.city);
        return `
          <div class="case-cover bg-gradient-to-br ${grad}">
            <div class="h-full w-full flex items-end p-4">
              <div class="text-white">
                <div class="text-xs opacity-90">${cityShown || ''}${c.year ? ` · ${c.year}` : ''}</div>
                <div class="mt-1 font-semibold">${c.title || ''}</div>
              </div>
            </div>
          </div>
        `;
      };

      const renderCard = (c) => {
        const el = document.createElement('article');
        el.className = 'case-card';

        const cityShown = normalizeCityForUi(c.city);

        const tagHtml = (c.tags || []).slice(0, 4).map((t) => renderTagPill(t)).join('');
        const scopeHtml = (c.scope || []).slice(0, 3).map((t) => `<li>${t}</li>`).join('');
        const detailHref = `./${c.id}.html`;
        const catLabel = categories.find((x) => x.key === c.category)?.label || '案例';

        el.innerHTML = `
          ${renderCover(c)}
          <div class="p-5">
            <div class="flex items-center justify-between gap-3">
              <div class="text-xs text-slate-500 inline-flex items-center gap-2">
                <span class="inline-block h-2.5 w-2.5 rounded-sm ${categoryColor(c.category)}"></span>
                <span>${catLabel}</span>
              </div>
              <div class="text-xs text-slate-400">${cityShown || ''}${c.year ? ` · ${c.year}` : ''}</div>
            </div>
            <div class="mt-2 font-semibold">${c.title || ''}</div>
            <div class="mt-2 text-sm text-slate-600">${trunc(c.description || '—', 30)}</div>
            <div class="mt-3 flex flex-wrap gap-2">${tagHtml}</div>
            <div class="mt-4 text-sm font-semibold text-slate-900">交付范围（建议）</div>
            <ul class="mt-2 list-disc pl-5 text-sm text-slate-600">${scopeHtml}</ul>
            <div class="mt-4">
              <a class="btn btn-outlined w-full" href="${detailHref}" aria-label="查看案例详情">查看案例详情</a>
              <button type="button" class="btn btn-text w-full mt-2" data-id="${c.id}">查看模板字段</button>
            </div>
          </div>
        `;

        const btn = el.querySelector('button[data-id]');
        if (btn) btn.addEventListener('click', () => openModal(c));
        return el;
      };


      const getKeyword = () => String(keywordEl.value || '').trim().toLowerCase();

      const timeOptions = Array.from({ length: 25 }, (_, i) => {
        const y = 2001 + i;
        return String(y);
      });

      const tagGroups = [
        { key: 'time', label: '时间', options: timeOptions },
        { key: 'place', label: '地点', options: ['北京', '江苏省', '陕西省', '云南省', '线上'] },
        { key: 'theme', label: '主题', options: ['博物馆', '国家博物馆', '红色党建', '成就展', '城市展厅', '商业展示'] },
        { key: 'tech', label: '特色', options: ['沉浸式', '互动', '导视标识', '灯箱', '结构与面材', '数字化展陈', '灯箱系统', '互动装置', '其他'] }
      ];

      const renderGroupChip = (groupKey, value, displayLabel) => {
        const real = (value && typeof value === 'object') ? value.value : value;
        const label = (value && typeof value === 'object') ? value.label : value;
        const shown = displayLabel != null ? String(displayLabel) : String(label);
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'filter-chip case-tag-chip';
        btn.dataset.group = groupKey;
        btn.dataset.value = String(real);

        if (real === 'all') {
          btn.textContent = shown;
        } else {
          const color = tagColor(shown);
          const safe = String(shown);
          btn.innerHTML = `<span style="display:inline-flex;align-items:center;gap:.4rem;"><span aria-hidden="true" style="width:.45rem;height:.45rem;border-radius:999px;background:${color};"></span><span>${safe}</span></span>`;
        }

        btn.addEventListener('click', () => {
          active[groupKey] = String(real);
          render();
        });
        return btn;
      };

      const renderTagGroups = () => {
        tagFiltersEl.innerHTML = '';
        tagGroups.forEach((g) => {
          const wrap = document.createElement('div');
          wrap.className = 'case-tag-group';
          wrap.dataset.caseGroup = g.key;
          const row = document.createElement('div');
          row.className = 'case-tag-row';

          const prefix = document.createElement('div');
          prefix.className = 'case-tag-prefix';
          prefix.appendChild(renderGroupChip(g.key, 'all', g.label));

          const strip = document.createElement('div');
          strip.className = 'case-tag-strip';
          g.options.forEach((v) => strip.appendChild(renderGroupChip(g.key, v)));

          row.appendChild(prefix);
          row.appendChild(strip);
          wrap.appendChild(row);
          tagFiltersEl.appendChild(wrap);
        });
      };

      const autoScrollTimeStrip = () => {
        try {
          if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
          const strip = document.querySelector('[data-case-group="time"] .case-tag-strip');
          if (!strip) return;

          // If already at end (e.g. user refreshed mid-way), skip.
          const max = Math.max(0, strip.scrollWidth - strip.clientWidth);
          if (max <= 8) return;

          // Reset to start, then animate to end once.
          strip.scrollLeft = 0;

          let cancelled = false;
          const cancel = () => { cancelled = true; };
          const opts = { passive: true };
          strip.addEventListener('wheel', cancel, opts);
          strip.addEventListener('touchstart', cancel, opts);
          strip.addEventListener('pointerdown', cancel, opts);
          strip.addEventListener('mousedown', cancel, opts);

          const duration = 1800;
          const start = performance.now();
          const easeOutCubic = (t) => 1 - Math.pow(1 - t, 3);

          const tick = (now) => {
            if (cancelled) return;
            const p = Math.min(1, (now - start) / duration);
            strip.scrollLeft = Math.round(max * easeOutCubic(p));
            if (p < 1) requestAnimationFrame(tick);
          };

          requestAnimationFrame(tick);
        } catch (e) {
          // ignore
        }
      };

      const renderActions = () => {
        filtersEl.innerHTML = '';
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'btn btn-outlined';
        btn.innerHTML = '<i class="fa-solid fa-rotate-left"></i><span>清空筛选</span>';
        btn.addEventListener('click', () => {
          active.time = 'all';
          active.place = 'all';
          active.theme = 'all';
          active.tech = 'all';
          keywordEl.value = '';
          render();
        });
        filtersEl.appendChild(btn);
      };

      const show = (el) => {
        if (!el) return;
        el.classList.remove('hidden');
      };

      const hide = (el) => {
        if (!el) return;
        el.classList.add('hidden');
      };

      const renderModalField = (label, value) => {
        const safe = (v) => String(v || '—');
        return `
          <div class="rounded-2xl border border-slate-200 bg-slate-50 p-4" style="border-radius:var(--radius)">
            <div class="text-xs text-slate-500">${safe(label)}</div>
            <div class="mt-1 text-sm font-semibold text-slate-900" style="white-space:pre-wrap">${safe(value)}</div>
          </div>
        `;
      };

      const openModal = (c) => {
        if (!modal || !modalTitle || !modalBody) return;
        modalTitle.textContent = c.title || '案例详情';
        const cat = categories.find((x) => x.key === c.category)?.label || '—';
        const cityShown = normalizeCityForUi(c.city);
        modalBody.innerHTML = [
          renderModalField('项目名称', c.title),
          renderModalField('类型', cat),
          renderModalField('原站分类（抓取）', c.original_category),
          renderModalField('地区', cityShown || c.city),
          renderModalField('年份', c.year),
          renderModalField('标签（建议）', (c.tags || []).join('、') || '—'),
          renderModalField('交付范围（建议）', (c.scope || []).join('、') || '—'),
          renderModalField('亮点/指标（建议）', (c.highlights || []).join('、') || '—'),
          renderModalField('原站地址', c.source_url || '—')
        ].join('');
        show(modal);
        document.body.style.overflow = 'hidden';
        modal.focus();
      };

      const closeModal = () => {
        if (!modal) return;
        hide(modal);
        document.body.style.overflow = '';
      };

      if (modal) {
        modal.querySelectorAll('[data-modal-close]').forEach((n) => n.addEventListener('click', closeModal));
        document.addEventListener('keydown', (e) => {
          if (modal.classList.contains('hidden')) return;
          if (e.key === 'Escape') {
            e.preventDefault();
            closeModal();
          }
        });
      }

      const render = () => {
        const kw = getKeyword();

        Array.from(tagFiltersEl.querySelectorAll('button.filter-chip')).forEach((n) => {
          const g = n.dataset.group;
          const v = n.dataset.value;
          n.classList.toggle('is-active', g && v && active[g] === v);
        });

        const filtered = cases.filter((c) => {
          const tags = Array.isArray(c.tags) ? c.tags : [];
          const year = String(c.year || '').trim();
          const city = normalizeCityForUi(String(c.city || '').trim());

          if (active.time !== 'all') {
            const t = String(active.time);
            const pass = year === t || tags.includes(t);
            if (!pass) return false;
          }

          if (active.place !== 'all') {
            const t = String(active.place);
            const pass = city === t || tags.includes(t);
            if (!pass) return false;
          }

          if (active.theme !== 'all') {
            const t = String(active.theme);
            const pass = tags.includes(t);
            if (!pass) return false;
          }

          if (active.tech !== 'all') {
            const t = String(active.tech);
            const pass = tags.includes(t);
            if (!pass) return false;
          }

          if (!kw) return true;
          const hay = [c.title, normalizeCityForUi(c.city), c.year, c.original_category, c.description, ...(c.tags || []), ...(c.scope || []), ...(c.highlights || [])]
            .filter(Boolean)
            .join(' ')
            .toLowerCase();
          return hay.includes(kw);
        });

        listEl.innerHTML = '';
        if (!filtered.length) {
          const empty = document.createElement('div');
          empty.className = 'md:col-span-2 lg:col-span-3';
          empty.innerHTML = `
            <div class="rounded-3xl border border-slate-200 bg-white p-8 text-center" style="border-radius:var(--radius)">
              <div class="text-sm font-semibold text-slate-900">没有匹配的案例</div>
              <div class="mt-2 text-sm text-slate-600">请尝试切换分类或修改关键词。</div>
            </div>
          `;
          listEl.appendChild(empty);
        } else {
          filtered.forEach((c) => listEl.appendChild(renderCard(c)));
        }
        metaEl.textContent = `共 ${filtered.length} 条结果（本地数据，可由脚本更新）`;
        syncUrl();
      };

      const loadCases = async () => {
        metaEl.textContent = '正在加载案例数据…';

        if (location.protocol === 'file:') {
          showAlert('你正在以 file:// 方式打开页面，浏览器会阻止 fetch 读取 ./data/cases.json，所以案例不会显示。请用本地 HTTP 方式打开（例如 VSCode Live Server / 任意静态服务器），再刷新本页。');
        } else {
          hideAlert();
        }

        try {
          let data = null;
          try {
            const res2 = await fetch('./data/cases.v2.json', { cache: 'no-store' });
            if (res2.ok) data = await res2.json();
          } catch {
            // ignore, fall back
          }
          if (!data) {
            const res = await fetch('./data/cases.json', { cache: 'no-store' });
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            data = await res.json();
          }
          cases = Array.isArray(data) ? data : Array.isArray(data?.cases) ? data.cases : [];
        } catch (e) {
          cases = [];
          const msg = `案例数据加载失败：${e?.message || e}。请确认 cases/data/cases.json 存在，并通过 HTTP 方式打开本页（不要用 file:// 直接打开）。`;
          metaEl.textContent = msg;
          showAlert(msg);
        }

        renderTagGroups();
        renderActions();

        // time strip "walk" effect
        setTimeout(() => autoScrollTimeStrip(), 120);

        // apply URL params once after data loaded
        const { time, place, theme, tech, q } = readParams();
        if (time) active.time = time;
        if (place) active.place = place;
        if (theme) active.theme = theme;
        if (tech) active.tech = tech;
        if (q) keywordEl.value = q;

        render();
      };

      filtersEl.innerHTML = '';
      keywordEl.addEventListener('input', () => render());
      loadCases();
    })();
  </script>
</body>
</html>
